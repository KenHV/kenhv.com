#!/bin/bash

staged_files=$(git diff --cached --name-only --diff-filter=ACM | grep -E "^public/.*\.(html|css|js)$")

if [[ -z "$staged_files" ]]; then
  exit 0
fi

for file in $staged_files; do
  html-minifier-terser \
    --collapse-boolean-attributes \
    --collapse-whitespace \
    --conservative-collapse \
    --decode-entities \
    --minify-css \
    --minify-js \
    --preserve-line-breaks \
    --remove-comments \
    --remove-empty-attributes \
    --remove-redundant-attributes \
    --remove-script-type-attributes \
    --remove-style-link-type-attributes \
    --trim-custom-fragments \
    --use-short-doctype \
    -o $file $file
done

git add $staged_files
